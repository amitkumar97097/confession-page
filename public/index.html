<!DOCTYPE html>
<html>
<head>
  <title>Confession</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

<div class="container">
  <div class="toggle" onclick="toggleMode()">ğŸŒ™ / â˜€ï¸</div>

  <h2>ğŸ’Œ Confession Box</h2>
  <div class="logo">Anonymous â€¢ Safe â€¢ Private</div>

  <textarea id="msg" placeholder="Type your confession or love letter here..."></textarea>

  <!-- ğŸ“¸ Image Upload -->
  <label class="upload">
    ğŸ“· Upload Photo (optional)
    <input type="file" id="img" accept="image/*" hidden onchange="previewImage()">
  </label>

  <!-- ğŸ‘€ Image Preview -->
  <img id="preview" style="
    display:none;
    margin-top:10px;
    width:100%;
    border-radius:12px;
  ">

  <button id="btn" onclick="send()">Send Confession</button>

  <div class="footer">
    Made with â¤ï¸ for Instagram Confessions
  </div>
</div>

<audio id="snd">
  <source src="https://assets.mixkit.co/sfx/preview/mixkit-message-pop-alert-2354.mp3">
</audio>

<script>
function previewImage(){
  const file = img.files[0];
  if(!file) return;

  if(file.size > 5 * 1024 * 1024){
    alert("Image must be under 5MB âŒ");
    img.value = "";
    return;
  }

  const reader = new FileReader();
  reader.onload = () => {
    preview.src = reader.result;
    preview.style.display = "block";
  };
  reader.readAsDataURL(file);
}

function send(){
  const message = msg.value.trim();
  const image = img.files[0];
  const btn = document.getElementById("btn");

  if(!message && !image){
    alert("Write something or upload a photo ğŸ˜…");
    return;
  }

  const formData = new FormData();
  if(message) formData.append("message", message);
  if(image) formData.append("image", image);

  btn.innerText = "Sending...";
  btn.disabled = true;
  snd.play();

  fetch("/confess",{
    method:"POST",
    body: formData
  })
  .then(res => res.json())
  .then(d => {
    if(d.success){
      msg.value = "";
      img.value = "";
      preview.style.display = "none";
      alert("Confession Sent â¤ï¸");
    }else{
      alert(d.error || "Something went wrong âŒ");
    }
  })
  .catch(()=>{
    alert("Server error âŒ");
  })
  .finally(()=>{
    btn.innerText = "Send Confession";
    btn.disabled = false;
  });
}

function toggleMode(){
  document.body.classList.toggle("light");
}
</script>

</body>
</html>
